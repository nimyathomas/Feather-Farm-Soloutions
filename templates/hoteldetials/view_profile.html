{% extends 'hoteldetials/dashboard.html' %}

{% block content %}
<div class="container">
    <div class="row">
        <!-- User Information Form -->
        <form method="POST" enctype="multipart/form-data" class="col-md-6">
            {% csrf_token %}
            <h3>User Information</h3>
            <fieldset>
                <!-- Email -->
                <div class="form-group">
                    <label for="email">Email</label>
                    {{ user_form.email }}
                    {% if user_form.email.errors %}
                        <div class="errorlist">
                            {% for error in user_form.email.errors %}
                                <p class="error">{{ error }}</p>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>

                <!-- Full Name -->
                <div class="form-group">
                    <label for="full_name">Full Name</label>
                    {{ user_form.full_name }}
                    {% if user_form.full_name.errors %}
                        <div class="errorlist">
                            {% for error in user_form.full_name.errors %}
                                <p class="error">{{ error }}</p>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>

                <!-- Phone Number -->
                <div class="form-group">
                    <label for="phone_number">Phone Number</label>
                    {{ user_form.phone_number }}
                    {% if user_form.phone_number.errors %}
                        <div class="errorlist">
                            {% for error in user_form.phone_number.errors %}
                                <p class="error">{{ error }}</p>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
                <button type="submit" name="update_profile" class="btn btn-primary mt-3">Update</button>
            </fieldset>
        </form>

        <!-- Hotel Information Form -->
        <form method="POST" enctype="multipart/form-data" class="col-md-6">
            {% csrf_token %}
            <h3>Hotel Information</h3>
            <fieldset>
                <!-- Hotel Name -->
                <div class="form-group">
                    <label for="hotel_name">Hotel Name</label>
                    {{ hotel_form.hotel_name }}
                    {% if hotel_form.hotel_name.errors %}
                        <div class="errorlist">
                            {% for error in hotel_form.hotel_name.errors %}
                                <p class="error">{{ error }}</p>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
                <!-- Longitude -->
                <div class="form-group">
                    <label for="address">Address</label>
                    {{ hotel_form.address }}
                    {% if hotel_form.address.errors %}
                        <div class="errorlist">
                            {% for error in hotel_form.address.errors %}
                                <p class="error">{{ error }}</p>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>

                <!-- Latitude -->
                <div class="form-group">
                    <label for="latitude">Latitude</label>
                    {{ hotel_form.latitude }}
                    {% if hotel_form.latitude.errors %}
                        <div class="errorlist">
                            {% for error in hotel_form.latitude.errors %}
                                <p class="error">{{ error }}</p>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>

                <!-- Longitude -->
                <div class="form-group">
                    <label for="longitude">Longitude</label>
                    {{ hotel_form.longitude }}
                    {% if hotel_form.longitude.errors %}
                        <div class="errorlist">
                            {% for error in hotel_form.longitude.errors %}
                                <p class="error">{{ error }}</p>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>

                <!-- Hotel License -->
                <div class="form-group">
                    <label for="hotel_license">Hotel License</label>
                    {{ hotel_form.hotel_license }}
                    {% if hotel_form.hotel_license.errors %}
                        <div class="errorlist">
                            {% for error in hotel_form.hotel_license.errors %}
                                <p class="error">{{ error }}</p>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
            </fieldset>

            <!-- Button to Get Location -->
            <button type="button" id="get-location" class="btn btn-info mt-3">
                Allow Location Access
            </button>
            <small class="form-text text-muted">
                Click the button to fetch your current location.
            </small>
            <div id="location-feedback" class="text-info mt-2"></div>

            <button type="submit" name="update_hotel" class="btn btn-primary mt-3">Submit</button>
        </form>
    </div>
</div>

<!-- JavaScript to Fetch Latitude and Longitude -->
<script>
    document
        .getElementById("get-location")
        .addEventListener("click", function () {
            const latitudeField = document.querySelector('[name="latitude"]');
            const longitudeField = document.querySelector('[name="longitude"]');
            const feedbackElement = document.getElementById("location-feedback");

            // Check if Geolocation is supported/enabled
            if (navigator.geolocation) {
                feedbackElement.textContent = "Fetching your location...";
                feedbackElement.className = "text-info mt-2";

                // Get user's current position
                navigator.geolocation.getCurrentPosition(
                    function (position) {
                        const latitude = position.coords.latitude;
                        const longitude = position.coords.longitude;

                        // Set the latitude and longitude fields
                        latitudeField.value = latitude;
                        longitudeField.value = longitude;

                        feedbackElement.textContent = `Location fetched successfully: Latitude: ${latitude}, Longitude: ${longitude}`;
                        feedbackElement.className = "text-success mt-2";
                    },
                    function (error) {
                        // Handle location errors
                        switch (error.code) {
                            case error.PERMISSION_DENIED:
                                feedbackElement.textContent = "User denied location access.";
                                break;
                            case error.POSITION_UNAVAILABLE:
                                feedbackElement.textContent = "Location information is unavailable.";
                                break;
                            case error.TIMEOUT:
                                feedbackElement.textContent = "The request to get user location timed out.";
                                break;
                            case error.UNKNOWN_ERROR:
                                feedbackElement.textContent = "An unknown error occurred.";
                                break;
                        }
                        feedbackElement.className = "text-danger mt-2";
                    }
                );
            } else {
                feedbackElement.textContent = "Geolocation is not supported by this browser.";
                feedbackElement.className = "text-danger mt-2";
            }
        });
</script>
{% endblock %}
